<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitalCore Cardiology AI Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .cardiology-gradient { background: linear-gradient(135deg, #dc2626 0%, #f87171 100%); }
        .critical-pulse { animation: critical-pulse 1s infinite; }
        @keyframes critical-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        .ecg-line { 
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10 L20 10 L25 2 L30 18 L35 10 L40 10 L45 8 L50 12 L55 10 L100 10' stroke='%23ef4444' stroke-width='2' fill='none'/%3E%3C/svg%3E") repeat-x;
            height: 40px;
            animation: ecg-scroll 2s linear infinite;
        }
        @keyframes ecg-scroll {
            0% { background-position: 0 0; }
            100% { background-position: 100px 0; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="cardiologyAgentApp()" x-init="init()">
        <!-- Header with ECG Animation -->
        <div class="cardiology-gradient text-white p-6">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-heartbeat text-4xl critical-pulse"></i>
                        <div>
                            <h1 class="text-3xl font-bold">VitalCore Cardiology AI Agent</h1>
                            <p class="text-red-100">HEMA3N-Powered Cardiac Emergency Response</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold" x-text="patientsAssessed"></div>
                        <p class="text-red-100">Patients Assessed</p>
                    </div>
                </div>
                
                <!-- ECG Line Animation -->
                <div class="ecg-line mt-4 rounded"></div>
            </div>
        </div>

        <!-- Emergency Cardiac Assessment -->
        <div class="max-w-6xl mx-auto p-6">
            <!-- Quick Cardiac Emergency Triage -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Immediate Cardiac Threats -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-red-600 mb-6 flex items-center">
                        <i class="fas fa-exclamation-triangle mr-3 critical-pulse"></i>
                        Immediate Cardiac Threats
                    </h2>
                    
                    <div class="space-y-4">
                        <button @click="assessEmergency('cardiac_arrest')" 
                                class="w-full bg-red-600 text-white p-4 rounded-lg hover:bg-red-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="text-left">
                                    <h3 class="font-bold text-lg">Cardiac Arrest</h3>
                                    <p class="text-red-100 text-sm">No pulse, unconscious, not breathing</p>
                                </div>
                                <i class="fas fa-heart text-3xl"></i>
                            </div>
                        </button>
                        
                        <button @click="assessEmergency('stemi')"
                                class="w-full bg-red-500 text-white p-4 rounded-lg hover:bg-red-600 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="text-left">
                                    <h3 class="font-bold text-lg">STEMI Heart Attack</h3>
                                    <p class="text-red-100 text-sm">Severe chest pain, ST elevation</p>
                                </div>
                                <i class="fas fa-heartbeat text-3xl"></i>
                            </div>
                        </button>
                        
                        <button @click="assessEmergency('vfib')"
                                class="w-full bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="text-left">
                                    <h3 class="font-bold text-lg">V-Fib/V-Tach</h3>
                                    <p class="text-orange-100 text-sm">Life-threatening arrhythmia</p>
                                </div>
                                <i class="fas fa-bolt text-3xl"></i>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- AI Cardiac Analysis -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-blue-600 mb-6 flex items-center">
                        <i class="fas fa-brain mr-3"></i>
                        AI Cardiac Analysis
                    </h2>
                    
                    <!-- Voice Input for Symptoms -->
                    <div class="text-center mb-6">
                        <button @click="toggleVoiceInput()" 
                                :class="{
                                    'bg-red-500': isRecording,
                                    'bg-blue-500': !isRecording
                                }"
                                class="w-20 h-20 rounded-full text-white text-2xl hover:opacity-80 transition-all">
                            <i :class="isRecording ? 'fas fa-stop' : 'fas fa-microphone'"></i>
                        </button>
                        <p class="mt-2 text-sm text-gray-600" 
                           x-text="isRecording ? 'Describe cardiac symptoms...' : 'Tap to describe symptoms'">
                        </p>
                    </div>

                    <!-- Symptom Input -->
                    <div x-show="transcript || symptoms.length > 0" class="mb-6">
                        <div x-show="transcript" class="bg-blue-50 p-3 rounded-lg mb-4">
                            <p class="text-blue-800 text-sm" x-text="transcript"></p>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            <template x-for="symptom in symptoms" :key="symptom">
                                <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">
                                    <span x-text="symptom"></span>
                                </span>
                            </template>
                        </div>
                        
                        <button @click="analyzeCardiacSymptoms()" 
                                class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-stethoscope mr-2"></i>AI Cardiac Analysis
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Analysis Results -->
            <div x-show="cardiacAnalysis" class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">HEMA3N Cardiology Assessment</h2>
                    <div :class="getRiskColor(cardiacAnalysis?.riskLevel)" 
                         class="px-4 py-2 rounded-full text-white font-bold">
                        <span x-text="cardiacAnalysis?.riskLevel?.toUpperCase()"></span>
                    </div>
                </div>

                <!-- Primary Diagnosis -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-3">Primary Cardiac Diagnosis</h3>
                        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                            <h4 class="font-bold text-red-800" x-text="cardiacAnalysis?.primaryDiagnosis?.name"></h4>
                            <p class="text-red-700 text-sm" x-text="cardiacAnalysis?.primaryDiagnosis?.description"></p>
                            <div class="mt-2 text-right">
                                <span class="text-2xl font-bold text-red-600" 
                                      x-text="cardiacAnalysis?.primaryDiagnosis?.confidence + '%'"></span>
                                <span class="text-xs text-red-500">AI Confidence</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-3">Immediate Actions</h3>
                        <template x-for="(action, index) in cardiacAnalysis?.immediateActions" :key="index">
                            <div class="flex items-start space-x-3 p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded mb-2">
                                <div class="w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center text-sm font-bold">
                                    <span x-text="index + 1"></span>
                                </div>
                                <p class="text-yellow-800 text-sm" x-text="action"></p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Critical Interventions -->
                <div x-show="cardiacAnalysis?.riskLevel === 'critical'" 
                     class="bg-red-50 border-2 border-red-500 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-red-800 mb-4 flex items-center">
                        <i class="fas fa-exclamation-triangle mr-3 critical-pulse"></i>
                        Critical Cardiac Intervention Protocol
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button @click="activateACLS()" 
                                class="bg-red-600 text-white p-4 rounded-lg hover:bg-red-700">
                            <i class="fas fa-heart text-2xl mb-2"></i>
                            <p class="font-bold">ACLS Protocol</p>
                        </button>
                        
                        <button @click="call911()" 
                                class="bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700 critical-pulse">
                            <i class="fas fa-phone text-2xl mb-2"></i>
                            <p class="font-bold">CALL 911 NOW</p>
                        </button>
                        
                        <button @click="prepareTransport()" 
                                class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-ambulance text-2xl mb-2"></i>
                            <p class="font-bold">Prep Transport</p>
                        </button>
                    </div>
                </div>

                <!-- Vital Signs Monitoring -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Cardiac Vital Signs</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Heart Rate</label>
                            <input type="number" x-model="vitals.heartRate" 
                                   class="w-full text-center text-xl font-bold p-2 border rounded"
                                   placeholder="BPM">
                        </div>
                        <div class="text-center">
                            <label class="block text-sm font-bold text-gray-700 mb-2">BP Systolic</label>
                            <input type="number" x-model="vitals.systolic"
                                   class="w-full text-center text-xl font-bold p-2 border rounded"
                                   placeholder="mmHg">
                        </div>
                        <div class="text-center">
                            <label class="block text-sm font-bold text-gray-700 mb-2">BP Diastolic</label>
                            <input type="number" x-model="vitals.diastolic"
                                   class="w-full text-center text-xl font-bold p-2 border rounded"
                                   placeholder="mmHg">
                        </div>
                        <div class="text-center">
                            <label class="block text-sm font-bold text-gray-700 mb-2">O2 Sat</label>
                            <input type="number" x-model="vitals.oxygen"
                                   class="w-full text-center text-xl font-bold p-2 border rounded"
                                   placeholder="%">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function cardiologyAgentApp() {
            return {
                patientsAssessed: 127,
                isRecording: false,
                transcript: '',
                symptoms: [],
                cardiacAnalysis: null,
                recognition: null,
                vitals: {
                    heartRate: '',
                    systolic: '',
                    diastolic: '',
                    oxygen: ''
                },

                init() {
                    this.initializeVoiceRecognition();
                    // Simulate real-time patient count updates
                    setInterval(() => {
                        if (Math.random() < 0.1) { // 10% chance every interval
                            this.patientsAssessed++;
                        }
                    }, 30000);
                },

                initializeVoiceRecognition() {
                    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                        this.recognition = new SpeechRecognition();
                        this.recognition.continuous = false;
                        this.recognition.interimResults = false;
                        this.recognition.lang = 'en-US';

                        this.recognition.onresult = (event) => {
                            const result = event.results[0][0].transcript;
                            this.transcript = result;
                            this.extractCardiacSymptoms(result);
                            this.isRecording = false;
                        };

                        this.recognition.onerror = () => {
                            this.isRecording = false;
                        };

                        this.recognition.onend = () => {
                            this.isRecording = false;
                        };
                    }
                },

                toggleVoiceInput() {
                    if (this.isRecording) {
                        this.recognition?.stop();
                    } else {
                        this.recognition?.start();
                        this.isRecording = true;
                    }
                },

                extractCardiacSymptoms(text) {
                    const cardiacSymptoms = {
                        'chest pain': ['chest pain', 'chest hurt', 'chest pressure', 'crushing pain'],
                        'shortness of breath': ['shortness of breath', 'cant breathe', 'difficulty breathing'],
                        'palpitations': ['palpitations', 'heart racing', 'irregular heartbeat'],
                        'dizziness': ['dizzy', 'lightheaded', 'faint'],
                        'sweating': ['sweating', 'diaphoresis', 'cold sweat'],
                        'nausea': ['nausea', 'nauseous', 'sick to stomach'],
                        'arm pain': ['arm pain', 'left arm pain', 'radiating pain'],
                        'jaw pain': ['jaw pain', 'jaw ache'],
                        'fatigue': ['fatigue', 'tired', 'weakness']
                    };

                    const textLower = text.toLowerCase();
                    for (const [symptom, keywords] of Object.entries(cardiacSymptoms)) {
                        if (keywords.some(keyword => textLower.includes(keyword))) {
                            if (!this.symptoms.includes(symptom)) {
                                this.symptoms.push(symptom);
                            }
                        }
                    }
                },

                assessEmergency(type) {
                    const emergencyProtocols = {
                        cardiac_arrest: {
                            riskLevel: 'critical',
                            primaryDiagnosis: {
                                name: 'Cardiac Arrest',
                                description: 'Complete cessation of cardiac activity - immediate CPR required',
                                confidence: 95
                            },
                            immediateActions: [
                                'Begin CPR immediately - 30:2 compressions to ventilations',
                                'Call 911 and request AED if available',
                                'Continue CPR until emergency services arrive',
                                'Administer epinephrine 1mg IV/IO every 3-5 minutes if trained'
                            ]
                        },
                        stemi: {
                            riskLevel: 'critical',
                            primaryDiagnosis: {
                                name: 'STEMI Heart Attack',
                                description: 'ST-elevation myocardial infarction - time-critical reperfusion needed',
                                confidence: 90
                            },
                            immediateActions: [
                                'Call 911 immediately - activate cardiac cath lab',
                                'Administer aspirin 325mg chewed if not contraindicated',
                                'Obtain 12-lead ECG and transmit to hospital',
                                'Start IV access and prepare for transport',
                                'Monitor for arrhythmias and cardiac arrest'
                            ]
                        },
                        vfib: {
                            riskLevel: 'critical',
                            primaryDiagnosis: {
                                name: 'Ventricular Fibrillation/Tachycardia',
                                description: 'Life-threatening arrhythmia requiring immediate defibrillation',
                                confidence: 92
                            },
                            immediateActions: [
                                'Immediate defibrillation if conscious and V-Fib confirmed',
                                'If unconscious, begin CPR and prepare for defibrillation',
                                'Charge defibrillator to 200J biphasic',
                                'Ensure all personnel clear before shock',
                                'Resume CPR immediately after shock for 2 minutes'
                            ]
                        }
                    };

                    this.cardiacAnalysis = emergencyProtocols[type];
                    this.speakUrgentAlert(this.cardiacAnalysis.primaryDiagnosis.name);
                },

                analyzeCardiacSymptoms() {
                    // HEMA3N-based cardiac symptom analysis
                    const analysis = this.performHEMA3NCardiacAnalysis(this.symptoms, this.vitals);
                    this.cardiacAnalysis = analysis;
                    this.speakAnalysis(analysis);
                },

                performHEMA3NCardiacAnalysis(symptoms, vitals) {
                    // Simulate HEMA3N cardiology model inference
                    let riskScore = 0;
                    let riskFactors = [];

                    // High-risk cardiac symptoms
                    const criticalSymptoms = ['chest pain', 'shortness of breath', 'palpitations'];
                    const moderateSymptoms = ['dizziness', 'sweating', 'nausea'];
                    const warningSymptoms = ['arm pain', 'jaw pain', 'fatigue'];

                    symptoms.forEach(symptom => {
                        if (criticalSymptoms.includes(symptom)) {
                            riskScore += 30;
                            riskFactors.push(`High-risk symptom: ${symptom}`);
                        } else if (moderateSymptoms.includes(symptom)) {
                            riskScore += 20;
                            riskFactors.push(`Moderate-risk symptom: ${symptom}`);
                        } else if (warningSymptoms.includes(symptom)) {
                            riskScore += 10;
                            riskFactors.push(`Warning symptom: ${symptom}`);
                        }
                    });

                    // Vital signs analysis
                    if (vitals.heartRate && (vitals.heartRate > 100 || vitals.heartRate < 60)) {
                        riskScore += 15;
                        riskFactors.push('Abnormal heart rate');
                    }
                    
                    if (vitals.systolic && (vitals.systolic > 180 || vitals.systolic < 90)) {
                        riskScore += 20;
                        riskFactors.push('Critical blood pressure');
                    }

                    if (vitals.oxygen && vitals.oxygen < 90) {
                        riskScore += 25;
                        riskFactors.push('Low oxygen saturation');
                    }

                    // Determine risk level and recommendations
                    let riskLevel, primaryDiagnosis, immediateActions;

                    if (riskScore >= 70) {
                        riskLevel = 'critical';
                        primaryDiagnosis = {
                            name: 'Acute Coronary Syndrome',
                            description: 'High probability of heart attack or unstable angina',
                            confidence: 85 + Math.min(riskScore - 70, 15)
                        };
                        immediateActions = [
                            'Call 911 immediately - do not delay',
                            'Administer aspirin 325mg if available and not contraindicated',
                            'Monitor vital signs every 2-3 minutes',
                            'Prepare for possible cardiac arrest',
                            'Keep patient calm and still'
                        ];
                    } else if (riskScore >= 40) {
                        riskLevel = 'high';
                        primaryDiagnosis = {
                            name: 'Cardiac Event Likely',
                            description: 'Significant cardiac symptoms requiring immediate evaluation',
                            confidence: 70 + Math.min(riskScore - 40, 20)
                        };
                        immediateActions = [
                            'Seek immediate medical attention',
                            'Consider emergency department evaluation',
                            'Monitor symptoms closely for worsening',
                            'Avoid physical exertion'
                        ];
                    } else {
                        riskLevel = 'moderate';
                        primaryDiagnosis = {
                            name: 'Cardiac Evaluation Recommended',
                            description: 'Symptoms warrant cardiac assessment by healthcare provider',
                            confidence: 60 + riskScore
                        };
                        immediateActions = [
                            'Contact healthcare provider today',
                            'Monitor symptoms for changes',
                            'Avoid strenuous activity until evaluated'
                        ];
                    }

                    return {
                        riskLevel,
                        primaryDiagnosis,
                        immediateActions,
                        riskFactors,
                        riskScore
                    };
                },

                getRiskColor(riskLevel) {
                    const colors = {
                        critical: 'bg-red-600',
                        high: 'bg-orange-600',
                        moderate: 'bg-yellow-600',
                        low: 'bg-green-600'
                    };
                    return colors[riskLevel] || 'bg-gray-600';
                },

                speakUrgentAlert(diagnosis) {
                    if ('speechSynthesis' in window) {
                        const text = `Critical cardiac emergency detected: ${diagnosis}. Initiating emergency protocol.`;
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.rate = 1.2;
                        utterance.pitch = 1.1;
                        utterance.volume = 1;
                        speechSynthesis.speak(utterance);
                    }
                },

                speakAnalysis(analysis) {
                    if ('speechSynthesis' in window) {
                        const text = `Cardiac assessment complete. Risk level: ${analysis.riskLevel}. Primary concern: ${analysis.primaryDiagnosis.name}. ${analysis.immediateActions[0]}`;
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.rate = 1;
                        speechSynthesis.speak(utterance);
                    }
                },

                activateACLS() {
                    alert('🚨 ACLS PROTOCOL ACTIVATED\n\n• Check rhythm and pulse\n• CPR if no pulse\n• Defibrillation for V-Fib/V-Tach\n• Epinephrine 1mg IV/IO every 3-5 min\n• Advanced airway management\n\nContinue until ROSC or termination');
                },

                call911() {
                    this.speakUrgentAlert('Emergency services being contacted');
                    alert('🚨 EMERGENCY SERVICES CONTACTED\n\n📞 911 CALLED\n🏥 CARDIAC ALERT ACTIVATED\n📍 Location transmitted\n⏱️ ETA: 6-8 minutes\n\nContinue cardiac protocol until arrival');
                },

                prepareTransport() {
                    alert('🚑 TRANSPORT PREPARATION\n\n• IV access established\n• Cardiac monitor attached\n• Emergency medications ready\n• Oxygen therapy initiated\n• Hospital notification sent\n\nReady for emergency transport');
                }
            };
        }
    </script>
</body>
</html>