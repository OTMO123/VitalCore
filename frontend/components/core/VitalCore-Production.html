<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitalCore - Healthcare Intelligence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../api/vitalcore-client.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .vital-gradient { background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%); }
        .vault-gradient { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .brain-gradient { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }
        .cardiology-gradient { background: linear-gradient(135deg, #dc2626 0%, #f87171 100%); }
        .psychology-gradient { background: linear-gradient(135deg, #059669 0%, #34d399 100%); }
        .pediatric-gradient { background: linear-gradient(135deg, #0ea5e9 0%, #60a5fa 100%); }
        .neurology-gradient { background: linear-gradient(135deg, #7c2d12 0%, #f97316 100%); }
        .oncology-gradient { background: linear-gradient(135deg, #581c87 0%, #a855f7 100%); }
        .radiology-gradient { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); }
        .emergency-gradient { background: linear-gradient(135deg, #b91c1c 0%, #ef4444 100%); }
        .general-gradient { background: linear-gradient(135deg, #374151 0%, #6b7280 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .skeleton { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .skeleton-bg { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; }
        .toast { transition: all 0.3s ease; }
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .chart-container { min-height: 300px; }
        .notification-badge { animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-3px); } 60% { transform: translateY(-2px); } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div x-data="vitalCoreApp()" x-init="init()" class="min-h-screen">
        <!-- Loading Overlay -->
        <div x-show="isLoading" x-transition:enter="transition ease-out duration-300" 
             x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 flex items-center space-x-4">
                <div class="spinner w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                <span class="text-gray-700">Loading healthcare data...</span>
            </div>
        </div>

        <!-- Error Toast -->
        <div x-show="errorMessage" x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-full"
             x-transition:enter-end="opacity-100 transform translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-x-0"
             x-transition:leave-end="opacity-0 transform translate-x-full"
             class="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
            <div class="flex items-center space-x-2">
                <i class="fas fa-exclamation-triangle"></i>
                <span x-text="errorMessage"></span>
                <button @click="errorMessage = ''" class="ml-2 text-white hover:text-red-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Success Toast -->
        <div x-show="successMessage" x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-full"
             x-transition:enter-end="opacity-100 transform translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-x-0"
             x-transition:leave-end="opacity-0 transform translate-x-full"
             class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
            <div class="flex items-center space-x-2">
                <i class="fas fa-check-circle"></i>
                <span x-text="successMessage"></span>
                <button @click="successMessage = ''" class="ml-2 text-white hover:text-green-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Header -->
        <header class="glass border-b border-white/20 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo -->
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 vital-gradient rounded-xl flex items-center justify-center">
                            <i class="fas fa-heartbeat text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">VitalCore</h1>
                            <p class="text-xs text-gray-500">Healthcare Intelligence Platform</p>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <nav class="hidden md:flex items-center space-x-8">
                        <button @click="setView('dashboard')" 
                                :class="currentView === 'dashboard' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'"
                                class="pb-4 px-1 border-b-2 border-transparent transition-colors">
                            <i class="fas fa-chart-line mr-2"></i>Dashboard
                        </button>
                        <button @click="setView('medvault')" 
                                :class="currentView === 'medvault' ? 'text-green-600 border-b-2 border-green-600' : 'text-gray-600 hover:text-gray-900'"
                                class="pb-4 px-1 border-b-2 border-transparent transition-colors">
                            <i class="fas fa-shield-alt mr-2"></i>MedVault
                        </button>
                        <button @click="setView('medbrain')" 
                                :class="currentView === 'medbrain' ? 'text-purple-600 border-b-2 border-purple-600' : 'text-gray-600 hover:text-gray-900'"
                                class="pb-4 px-1 border-b-2 border-transparent transition-colors">
                            <i class="fas fa-brain mr-2"></i>MedBrain
                        </button>
                        <button @click="setView('patients')" 
                                :class="currentView === 'patients' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'"
                                class="pb-4 px-1 border-b-2 border-transparent transition-colors">
                            <i class="fas fa-users mr-2"></i>Patients
                        </button>
                        <button @click="setView('analytics')" 
                                :class="currentView === 'analytics' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'"
                                class="pb-4 px-1 border-b-2 border-transparent transition-colors">
                            <i class="fas fa-chart-bar mr-2"></i>Analytics
                        </button>
                    </nav>

                    <!-- User Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- System Status Indicator -->
                        <div class="flex items-center space-x-2">
                            <div :class="systemHealth.status === 'healthy' ? 'bg-green-500' : 'bg-red-500'" 
                                 class="w-2 h-2 rounded-full"></div>
                            <span class="text-xs text-gray-600" x-text="systemHealth.status === 'healthy' ? 'System Healthy' : 'System Issues'"></span>
                        </div>

                        <!-- Notifications -->
                        <div class="relative">
                            <button @click="showNotifications = !showNotifications" class="p-2 text-gray-600 hover:text-gray-900 transition-colors relative">
                                <i class="fas fa-bell text-lg"></i>
                                <span x-show="realTimeNotifications.length > 0" 
                                      class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center notification-badge" 
                                      x-text="realTimeNotifications.length"></span>
                            </button>
                        </div>

                        <!-- User Profile -->
                        <div class="flex items-center space-x-3" x-show="currentUser">
                            <div class="w-8 h-8 vital-gradient rounded-full flex items-center justify-center">
                                <span class="text-white text-sm font-medium" x-text="currentUser ? currentUser.initials : 'U'"></span>
                            </div>
                            <div class="hidden md:block">
                                <p class="text-sm font-medium" x-text="currentUser ? currentUser.name : 'User'"></p>
                                <p class="text-xs text-gray-500" x-text="currentUser ? currentUser.role : 'Role'"></p>
                            </div>
                        </div>

                        <!-- Login Button (if not authenticated) -->
                        <button x-show="!vitalcore.isAuthenticated()" @click="showLogin = true" 
                                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            Login
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" x-transition class="fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">VitalCore Dashboard</h2>
                    <p class="text-gray-600">Real-time healthcare intelligence and system analytics</p>
                </div>

                <!-- Platform Overview Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- MedVault Card -->
                    <div @click="setView('medvault')" class="glass rounded-xl p-6 border border-white/20 card-hover cursor-pointer">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 vault-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-shield-alt text-white text-xl"></i>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">MedVault</h3>
                        <p class="text-sm text-gray-600 mb-4">Secure medical data storage with PHI protection and SOC2/HIPAA compliance</p>
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-green-600" x-show="!loadingDashboard" x-text="dashboardStats.secureRecords?.toLocaleString() || '0'"></div>
                                <div x-show="loadingDashboard" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
                                <span x-text="dashboardStats.securityScore || '99.9'"></span>% Secure
                            </span>
                        </div>
                    </div>

                    <!-- MedBrain Card -->
                    <div @click="setView('medbrain')" class="glass rounded-xl p-6 border border-white/20 card-hover cursor-pointer">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 brain-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-brain text-white text-xl"></i>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">MedBrain</h3>
                        <p class="text-sm text-gray-600 mb-4">AI assistant for clinical conversations and decision support</p>
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-purple-600" x-show="!loadingDashboard" x-text="dashboardStats.aiInteractions?.toLocaleString() || '0'"></div>
                                <div x-show="loadingDashboard" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full">
                                <span x-text="dashboardStats.aiAccuracy || '96.7'"></span>% Accuracy
                            </span>
                        </div>
                    </div>

                    <!-- Analytics Card -->
                    <div @click="setView('analytics')" class="glass rounded-xl p-6 border border-white/20 card-hover cursor-pointer">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 vital-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-bar text-white text-xl"></i>
                            </div>
                            <i class="fas fa-arrow-right text-gray-400"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Healthcare Analytics</h3>
                        <p class="text-sm text-gray-600 mb-4">Population health insights and predictive analytics</p>
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-blue-600" x-show="!loadingDashboard" x-text="dashboardStats.activePatients?.toLocaleString() || '0'"></div>
                                <div x-show="loadingDashboard" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <span class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full">Real-time</span>
                        </div>
                    </div>
                </div>

                <!-- System Health Indicators -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">System Health</p>
                                <div x-show="!loadingHealth">
                                    <p class="text-2xl font-bold" 
                                       :class="systemHealth.overall >= 95 ? 'text-green-600' : systemHealth.overall >= 80 ? 'text-yellow-600' : 'text-red-600'"
                                       x-text="systemHealth.overall + '%'"></p>
                                </div>
                                <div x-show="loadingHealth" class="w-12 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                 :class="systemHealth.overall >= 95 ? 'bg-green-100' : systemHealth.overall >= 80 ? 'bg-yellow-100' : 'bg-red-100'">
                                <i class="fas fa-heart" 
                                   :class="systemHealth.overall >= 95 ? 'text-green-600' : systemHealth.overall >= 80 ? 'text-yellow-600' : 'text-red-600'"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">API Response</p>
                                <div x-show="!loadingHealth">
                                    <p class="text-2xl font-bold" 
                                       :class="systemHealth.responseTime <= 200 ? 'text-green-600' : systemHealth.responseTime <= 500 ? 'text-yellow-600' : 'text-red-600'"
                                       x-text="systemHealth.responseTime + 'ms'"></p>
                                </div>
                                <div x-show="loadingHealth" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-bolt text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Compliance</p>
                                <div x-show="!loadingHealth">
                                    <p class="text-2xl font-bold text-green-600" x-text="systemHealth.compliance + '%'"></p>
                                </div>
                                <div x-show="loadingHealth" class="w-12 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-shield-alt text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">AI Models</p>
                                <div x-show="!loadingHealth">
                                    <p class="text-2xl font-bold" 
                                       :class="systemHealth.aiModelsOnline ? 'text-green-600' : 'text-red-600'"
                                       x-text="systemHealth.aiModelsOnline ? 'Online' : 'Offline'"></p>
                                </div>
                                <div x-show="loadingHealth" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                 :class="systemHealth.aiModelsOnline ? 'bg-purple-100' : 'bg-red-100'">
                                <i class="fas fa-robot" 
                                   :class="systemHealth.aiModelsOnline ? 'text-purple-600' : 'text-red-600'"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities and Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Recent Activity Feed -->
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Recent Activity</h3>
                            <button @click="loadRecentActivities()" class="text-sm text-blue-600 hover:text-blue-800">
                                <i class="fas fa-refresh mr-1"></i>Refresh
                            </button>
                        </div>
                        
                        <div x-show="loadingActivities" class="space-y-4">
                            <template x-for="i in 3" :key="i">
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 skeleton skeleton-bg rounded-full"></div>
                                    <div class="flex-1 space-y-2">
                                        <div class="w-3/4 h-4 skeleton skeleton-bg rounded"></div>
                                        <div class="w-1/2 h-3 skeleton skeleton-bg rounded"></div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div x-show="!loadingActivities" class="space-y-4 max-h-80 overflow-y-auto">
                            <template x-for="activity in recentActivities" :key="activity.id">
                                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center"
                                         :class="activity.type === 'error' ? 'bg-red-100 text-red-600' : 
                                                activity.type === 'warning' ? 'bg-yellow-100 text-yellow-600' : 
                                                'bg-blue-100 text-blue-600'">
                                        <i :class="activity.icon" class="text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900" x-text="activity.title"></p>
                                        <p class="text-xs text-gray-600" x-text="activity.description"></p>
                                        <div class="flex items-center justify-between mt-1">
                                            <p class="text-xs text-gray-400" x-text="formatTime(activity.timestamp)"></p>
                                            <span x-show="activity.patient_id" 
                                                  class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded"
                                                  x-text="'Patient: ' + activity.patient_id"></span>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div x-show="!loadingActivities && recentActivities.length === 0" 
                             class="text-center py-8 text-gray-500">
                            <i class="fas fa-inbox text-3xl mb-2"></i>
                            <p>No recent activities</p>
                        </div>
                    </div>

                    <!-- System Metrics Chart -->
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">System Performance</h3>
                        <div class="chart-container">
                            <div x-show="loadingMetrics" class="h-64 skeleton skeleton-bg rounded"></div>
                            <div x-show="!loadingMetrics" class="h-64 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg">
                                <div class="text-center text-gray-500">
                                    <i class="fas fa-chart-line text-3xl mb-2"></i>
                                    <p>Performance metrics chart</p>
                                    <p class="text-sm">API Response: <span x-text="systemHealth.responseTime + 'ms'"></span></p>
                                    <p class="text-sm">Uptime: <span x-text="systemHealth.uptime || '99.9%'"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MedVault View -->
            <div x-show="currentView === 'medvault'" x-transition class="fade-in">
                <div class="mb-8">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-12 h-12 vault-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-shield-alt text-white text-xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900">MedVault</h2>
                                <p class="text-gray-600">Secure medical data storage with enterprise-grade protection</p>
                            </div>
                        </div>
                        <button @click="loadVaultData()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh Data
                        </button>
                    </div>
                </div>

                <!-- Security Features -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-lock text-green-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">AES-256 Encryption</h3>
                        <p class="text-sm text-gray-600 mb-3">Military-grade encryption for all PHI data</p>
                        <div class="text-xs text-green-600 bg-green-50 px-2 py-1 rounded">
                            <span x-text="securityMetrics.encryptionStatus || 'Active'"></span>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-eye text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Audit Trails</h3>
                        <p class="text-sm text-gray-600 mb-3">Immutable logging of all data access</p>
                        <div class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded">
                            <span x-text="securityMetrics.auditRecords?.toLocaleString() || '0'"></span> Records
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-key text-purple-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Key Management</h3>
                        <p class="text-sm text-gray-600 mb-3">Rotating encryption keys</p>
                        <div class="text-xs text-purple-600 bg-purple-50 px-2 py-1 rounded">
                            Last Rotated: <span x-text="securityMetrics.lastKeyRotation || 'Today'"></span>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Security Breaches</h3>
                        <p class="text-sm text-gray-600 mb-3">Total security incidents</p>
                        <div class="text-xs text-red-600 bg-red-50 px-2 py-1 rounded">
                            <span x-text="securityMetrics.breaches || '0'"></span> Incidents
                        </div>
                    </div>
                </div>

                <!-- Data Storage Analytics -->
                <div class="glass rounded-xl p-6 border border-white/20 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">Storage Analytics</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div x-show="!loadingVault">
                                <p class="text-3xl font-bold text-green-600 mb-2" x-text="vaultData.totalRecords?.toLocaleString() || '0'"></p>
                            </div>
                            <div x-show="loadingVault" class="w-16 h-8 skeleton skeleton-bg rounded mx-auto mb-2"></div>
                            <p class="text-sm text-gray-600">Secure Records</p>
                        </div>
                        
                        <div class="text-center">
                            <div x-show="!loadingVault">
                                <p class="text-3xl font-bold text-blue-600 mb-2" x-text="vaultData.encryptedData || '0 TB'"></p>
                            </div>
                            <div x-show="loadingVault" class="w-16 h-8 skeleton skeleton-bg rounded mx-auto mb-2"></div>
                            <p class="text-sm text-gray-600">Encrypted Data</p>
                        </div>
                        
                        <div class="text-center">
                            <div x-show="!loadingVault">
                                <p class="text-3xl font-bold text-purple-600 mb-2" x-text="vaultData.dailyBackups || '0'"></p>
                            </div>
                            <div x-show="loadingVault" class="w-16 h-8 skeleton skeleton-bg rounded mx-auto mb-2"></div>
                            <p class="text-sm text-gray-600">Daily Backups</p>
                        </div>
                        
                        <div class="text-center">
                            <div x-show="!loadingVault">
                                <p class="text-3xl font-bold text-green-600 mb-2" x-text="vaultData.uptime || '99.9%'"></p>
                            </div>
                            <div x-show="loadingVault" class="w-16 h-8 skeleton skeleton-bg rounded mx-auto mb-2"></div>
                            <p class="text-sm text-gray-600">Uptime</p>
                        </div>
                    </div>
                </div>

                <!-- Recent PHI Access Log -->
                <div class="glass rounded-xl p-6 border border-white/20">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Recent PHI Access</h3>
                        <div class="flex items-center space-x-4">
                            <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm" x-model="auditLogFilter" @change="loadAuditLogs()">
                                <option value="all">All Events</option>
                                <option value="PHI_ACCESS">PHI Access</option>
                                <option value="LOGIN">Login Events</option>
                                <option value="SECURITY_VIOLATION">Security Violations</option>
                            </select>
                            <button @click="loadAuditLogs()" class="text-sm text-green-600 hover:text-green-800">
                                <i class="fas fa-refresh mr-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-2">Timestamp</th>
                                    <th class="text-left py-3 px-2">Event Type</th>
                                    <th class="text-left py-3 px-2">User</th>
                                    <th class="text-left py-3 px-2">Resource</th>
                                    <th class="text-left py-3 px-2">IP Address</th>
                                    <th class="text-left py-3 px-2">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-show="loadingAuditLogs" x-for="i in 5" :key="i">
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-2"><div class="w-32 h-4 skeleton skeleton-bg rounded"></div></td>
                                        <td class="py-3 px-2"><div class="w-24 h-4 skeleton skeleton-bg rounded"></div></td>
                                        <td class="py-3 px-2"><div class="w-20 h-4 skeleton skeleton-bg rounded"></div></td>
                                        <td class="py-3 px-2"><div class="w-28 h-4 skeleton skeleton-bg rounded"></div></td>
                                        <td class="py-3 px-2"><div class="w-24 h-4 skeleton skeleton-bg rounded"></div></td>
                                        <td class="py-3 px-2"><div class="w-16 h-4 skeleton skeleton-bg rounded"></div></td>
                                    </tr>
                                </template>

                                <template x-show="!loadingAuditLogs" x-for="log in auditLogs" :key="log.id">
                                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                                        <td class="py-3 px-2 text-xs" x-text="formatTime(log.timestamp)"></td>
                                        <td class="py-3 px-2">
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs"
                                                  :class="log.event_type === 'PHI_ACCESS' ? 'bg-blue-100 text-blue-800' : 
                                                         log.event_type === 'LOGIN' ? 'bg-green-100 text-green-800' : 
                                                         log.event_type === 'SECURITY_VIOLATION' ? 'bg-red-100 text-red-800' : 
                                                         'bg-gray-100 text-gray-800'"
                                                  x-text="log.event_type"></span>
                                        </td>
                                        <td class="py-3 px-2" x-text="log.user_name || log.user_id"></td>
                                        <td class="py-3 px-2" x-text="log.resource_type + '/' + (log.resource_id || 'N/A')"></td>
                                        <td class="py-3 px-2 text-xs font-mono" x-text="log.ip_address || 'N/A'"></td>
                                        <td class="py-3 px-2">
                                            <span :class="log.status === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                  class="px-2 py-1 text-xs rounded-full" x-text="log.status"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <div x-show="!loadingAuditLogs && auditLogs.length === 0" class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-3xl mb-2"></i>
                        <p>No audit logs found</p>
                    </div>
                </div>
            </div>

            <!-- MedBrain View -->
            <div x-show="currentView === 'medbrain'" x-transition class="fade-in">
                <div class="mb-8">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-12 h-12 brain-gradient rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">MedBrain</h2>
                            <p class="text-gray-600">AI assistant powered by Gemma 3n for clinical conversations</p>
                        </div>
                    </div>
                </div>

                <!-- AI Model Status -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-robot text-purple-600 text-xl"></i>
                            </div>
                            <div :class="aiModelStatus.status === 'online' ? 'text-green-500' : 'text-red-500'">
                                <i class="fas fa-circle text-sm"></i>
                            </div>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Gemma 3n Model</h3>
                        <p class="text-sm text-gray-600 mb-2" x-text="aiModelStatus.version || 'v3.1'"></p>
                        <div class="text-xs" 
                             :class="aiModelStatus.status === 'online' ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50'"
                             class="px-2 py-1 rounded">
                            <span x-text="aiModelStatus.status === 'online' ? 'Online' : 'Offline'"></span>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-comments text-green-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Conversations Today</h3>
                        <div x-show="!loadingAI">
                            <p class="text-3xl font-bold text-green-600 mb-2" x-text="aiStats.conversationsToday || '0'"></p>
                        </div>
                        <div x-show="loadingAI" class="w-16 h-8 skeleton skeleton-bg rounded mb-2"></div>
                        <p class="text-sm text-gray-600">Clinical queries</p>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-brain text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Model Accuracy</h3>
                        <div x-show="!loadingAI">
                            <p class="text-3xl font-bold text-blue-600 mb-2" x-text="(aiStats.accuracy || 96.7) + '%'"></p>
                        </div>
                        <div x-show="loadingAI" class="w-16 h-8 skeleton skeleton-bg rounded mb-2"></div>
                        <p class="text-sm text-gray-600">Clinical predictions</p>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Avg Response Time</h3>
                        <div x-show="!loadingAI">
                            <p class="text-3xl font-bold text-yellow-600 mb-2" x-text="(aiStats.responseTime || 1.2) + 's'"></p>
                        </div>
                        <div x-show="loadingAI" class="w-16 h-8 skeleton skeleton-bg rounded mb-2"></div>
                        <p class="text-sm text-gray-600">Processing time</p>
                    </div>
                </div>

                <!-- Enhanced MedBrain Chat Interface -->
                <div class="glass rounded-xl border border-white/20 h-96 flex flex-col mb-8">
                    <div class="flex items-center justify-between p-4 border-b border-gray-200">
                        <!-- Specialist Selection Dropdown -->
                        <div class="flex items-center space-x-4">
                            <div class="relative" x-data="{ open: false }">
                                <button @click="open = !open" 
                                        class="flex items-center space-x-3 px-4 py-2 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors">
                                    <div :class="getSpecialistGradient(selectedSpecialist)" class="w-8 h-8 rounded-full flex items-center justify-center">
                                        <i :class="getSpecialistIcon(selectedSpecialist)" class="text-white text-sm"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="text-sm font-medium text-gray-900" x-text="specialists.find(s => s.id === selectedSpecialist)?.name || 'General Practice'"></p>
                                        <p class="text-xs text-gray-500">Specialist</p>
                                    </div>
                                    <i class="fas fa-chevron-down text-gray-400"></i>
                                </button>
                                
                                <!-- Dropdown Menu -->
                                <div x-show="open" @click.away="open = false" x-transition
                                     class="absolute left-0 top-full mt-2 w-64 bg-white rounded-xl shadow-lg border border-gray-200 z-50 max-h-96 overflow-y-auto">
                                    <template x-for="specialist in specialists" :key="specialist.id">
                                        <button @click="selectedSpecialist = specialist.id; open = false"
                                                class="w-full flex items-center space-x-3 p-3 hover:bg-gray-50 transition-colors">
                                            <div :class="getSpecialistGradient(specialist.id)" class="w-10 h-10 rounded-full flex items-center justify-center">
                                                <i :class="specialist.icon" class="text-white"></i>
                                            </div>
                                            <div class="text-left">
                                                <p class="font-medium text-gray-900" x-text="specialist.name"></p>
                                                <p class="text-xs text-gray-500" x-text="specialist.description"></p>
                                            </div>
                                        </button>
                                    </template>
                                </div>
                            </div>
                            <h3 class="font-semibold text-gray-900">MedBrain Clinical Assistant</h3>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div :class="aiModelStatus.status === 'online' ? 'bg-green-500' : 'bg-red-500'" 
                                     class="w-2 h-2 rounded-full"></div>
                                <span class="text-sm text-gray-600" 
                                      x-text="aiModelStatus.status === 'online' ? 'AI Online' : 'AI Offline'"></span>
                            </div>
                            <button @click="clearChat()" class="text-sm text-gray-500 hover:text-gray-700">
                                <i class="fas fa-trash mr-1"></i>Clear Chat
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex-1 p-6 overflow-y-auto" id="chat-container">
                        <div class="space-y-4">
                            <template x-for="message in brainMessages" :key="message.id">
                                <div :class="message.sender === 'user' ? 'flex justify-end' : 'flex justify-start'">
                                    <div :class="message.sender === 'user' ? 'brain-gradient text-white' : 'bg-gray-100 text-gray-900'"
                                         class="max-w-xs lg:max-w-md px-4 py-3 rounded-lg">
                                        <p class="text-sm" x-html="formatMessage(message.content)"></p>
                                        <div class="flex items-center justify-between mt-2">
                                            <p class="text-xs opacity-75" x-text="formatTime(message.timestamp)"></p>
                                            <div x-show="message.confidence" class="text-xs opacity-75">
                                                Confidence: <span x-text="message.confidence + '%'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Typing Indicator -->
                        <div x-show="aiTyping" class="flex justify-start mt-4">
                            <div class="bg-gray-100 text-gray-900 px-4 py-3 rounded-lg">
                                <div class="flex items-center space-x-1">
                                    <div class="flex space-x-1">
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                                    </div>
                                    <span class="text-xs text-gray-500 ml-2">MedBrain is thinking...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 border-t border-gray-200">
                        <div class="flex space-x-3">
                            <input type="text" 
                                   x-model="brainInput"
                                   @keyup.enter="sendBrainMessage()"
                                   :disabled="!aiModelStatus.status === 'online'"
                                   placeholder="Ask about patient diagnosis, treatment protocols, drug interactions..."
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100">
                            
                            <!-- Voice Input Button -->
                            <button @click="toggleVoiceInput()" 
                                    :disabled="!aiModelStatus.status === 'online' || !voiceSupported"
                                    :class="{
                                        'bg-red-500 hover:bg-red-600': isRecording,
                                        'bg-blue-500 hover:bg-blue-600': isListening && !isRecording,
                                        'bg-gray-500 hover:bg-gray-600': !isRecording && !isListening
                                    }"
                                    class="text-white px-4 py-3 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed relative"
                                    title="Voice Input">
                                <i x-show="!isRecording && !isListening" class="fas fa-microphone"></i>
                                <i x-show="isListening && !isRecording" class="fas fa-ear-listen"></i>
                                
                                <!-- Recording Animation -->
                                <div x-show="isRecording" class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                                    <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                                    <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                                </div>
                            </button>
                            
                            <button @click="sendBrainMessage()" 
                                    :disabled="!brainInput.trim() || !aiModelStatus.status === 'online'"
                                    class="brain-gradient text-white px-6 py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                <i x-show="!aiTyping" class="fas fa-paper-plane"></i>
                                <i x-show="aiTyping" class="fas fa-spinner spinner"></i>
                            </button>
                        </div>
                        
                        <!-- Quick Action Buttons -->
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button @click="sendQuickMessage('What are the latest guidelines for Type 2 diabetes treatment?')"
                                    class="text-xs bg-purple-50 text-purple-600 px-3 py-1 rounded-full hover:bg-purple-100 transition-colors">
                                Diabetes Guidelines
                            </button>
                            <button @click="sendQuickMessage('Explain the contraindications for ACE inhibitors')"
                                    class="text-xs bg-purple-50 text-purple-600 px-3 py-1 rounded-full hover:bg-purple-100 transition-colors">
                                Drug Interactions
                            </button>
                            <button @click="sendQuickMessage('What are the red flags for chest pain in emergency medicine?')"
                                    class="text-xs bg-purple-50 text-purple-600 px-3 py-1 rounded-full hover:bg-purple-100 transition-colors">
                                Emergency Medicine
                            </button>
                        </div>
                    </div>
                </div>

                <!-- AI Capabilities Showcase -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass rounded-xl p-6 border border-white/20 text-center">
                        <div class="w-16 h-16 brain-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-stethoscope text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Clinical Analysis</h3>
                        <p class="text-sm text-gray-600 mb-4">AI-powered diagnostic assistance and clinical reasoning with medical literature integration</p>
                        <div class="text-xs text-purple-600 bg-purple-50 px-2 py-1 rounded">
                            <span x-text="aiStats.clinicalAnalyses || '1,247'"></span> Analyses Today
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20 text-center">
                        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-eye text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Multimodal AI</h3>
                        <p class="text-sm text-gray-600 mb-4">Analyze text, medical images, and patient data simultaneously for comprehensive insights</p>
                        <div class="text-xs text-green-600 bg-green-50 px-2 py-1 rounded">
                            <span x-text="aiStats.multimodalAnalyses || '432'"></span> Images Processed
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20 text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-shield-alt text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Privacy First</h3>
                        <p class="text-sm text-gray-600 mb-4">On-device processing ensures PHI never leaves your infrastructure</p>
                        <div class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded">
                            100% On-Premises Processing
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patients View -->
            <div x-show="currentView === 'patients'" x-transition class="fade-in">
                <div class="mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900 mb-2">Patient Management</h2>
                            <p class="text-gray-600">FHIR R4 compliant patient records with PHI encryption</p>
                        </div>
                        <button @click="showCreatePatient = true" 
                                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-plus mr-2"></i>New Patient
                        </button>
                    </div>
                </div>

                <!-- Patient Search and Filters -->
                <div class="glass rounded-xl p-6 border border-white/20 mb-8">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <input type="text" 
                                   x-model="patientSearch"
                                   @input="searchPatients()"
                                   placeholder="Search patients by name, MRN, SSN, or medical condition..."
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div class="flex gap-3">
                            <select x-model="patientFilters.gender" @change="searchPatients()"
                                    class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">All Genders</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                            <select x-model="patientFilters.status" @change="searchPatients()"
                                    class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                            <button @click="resetFilters()" 
                                    class="px-4 py-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Patient Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Patients</p>
                                <div x-show="!loadingPatients">
                                    <p class="text-2xl font-bold text-blue-600" x-text="patientStats.total?.toLocaleString() || '0'"></p>
                                </div>
                                <div x-show="loadingPatients" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-users text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Active Today</p>
                                <div x-show="!loadingPatients">
                                    <p class="text-2xl font-bold text-green-600" x-text="patientStats.activeToday?.toLocaleString() || '0'"></p>
                                </div>
                                <div x-show="loadingPatients" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-user-check text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">High Risk</p>
                                <div x-show="!loadingPatients">
                                    <p class="text-2xl font-bold text-red-600" x-text="patientStats.highRisk?.toLocaleString() || '0'"></p>
                                </div>
                                <div x-show="loadingPatients" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">New This Month</p>
                                <div x-show="!loadingPatients">
                                    <p class="text-2xl font-bold text-purple-600" x-text="patientStats.newThisMonth?.toLocaleString() || '0'"></p>
                                </div>
                                <div x-show="loadingPatients" class="w-16 h-6 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-user-plus text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patient Grid -->
                <div x-show="loadingPatients" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="i in 6" :key="i">
                        <div class="glass rounded-xl p-6 border border-white/20">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 skeleton skeleton-bg rounded-full"></div>
                                    <div class="space-y-2">
                                        <div class="w-24 h-4 skeleton skeleton-bg rounded"></div>
                                        <div class="w-20 h-3 skeleton skeleton-bg rounded"></div>
                                    </div>
                                </div>
                                <div class="w-16 h-5 skeleton skeleton-bg rounded"></div>
                            </div>
                            <div class="space-y-2">
                                <div class="w-full h-3 skeleton skeleton-bg rounded"></div>
                                <div class="w-3/4 h-3 skeleton skeleton-bg rounded"></div>
                                <div class="w-1/2 h-3 skeleton skeleton-bg rounded"></div>
                            </div>
                        </div>
                    </template>
                </div>

                <div x-show="!loadingPatients" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="patient in patients" :key="patient.id">
                        <div @click="viewPatient(patient)" 
                             class="glass rounded-xl p-6 border border-white/20 hover:shadow-lg transition-all cursor-pointer card-hover">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="text-blue-600 font-semibold" x-text="getPatientInitials(patient)"></span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900" x-text="getPatientName(patient)"></h3>
                                        <p class="text-sm text-gray-500">MRN: <span x-text="getPatientMRN(patient)"></span></p>
                                    </div>
                                </div>
                                <span :class="patient.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                                      class="px-2 py-1 text-xs rounded-full">
                                    <span x-text="patient.active ? 'Active' : 'Inactive'"></span>
                                </span>
                            </div>
                            
                            <div class="space-y-2 text-sm text-gray-600">
                                <p><i class="fas fa-birthday-cake mr-2"></i>
                                   <span x-text="calculateAge(patient.birthDate) + ' years old'"></span></p>
                                <p><i class="fas fa-venus-mars mr-2"></i>
                                   <span x-text="patient.gender || 'Not specified'"></span></p>
                                <p><i class="fas fa-calendar mr-2"></i>
                                   Last visit: <span x-text="patient.lastVisit || 'No recent visits'"></span></p>
                                <div x-show="patient.riskScore" class="flex items-center">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    Risk Score: <span x-text="patient.riskScore + '%'"></span>
                                </div>
                            </div>

                            <!-- Risk Assessment Bar -->
                            <div x-show="patient.riskScore" class="mt-4 pt-4 border-t border-gray-200">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs text-gray-500">Risk Assessment</span>
                                    <span class="text-xs font-medium" 
                                          :class="patient.riskScore < 30 ? 'text-green-600' : patient.riskScore < 70 ? 'text-yellow-600' : 'text-red-600'"
                                          x-text="getRiskLevel(patient.riskScore)"></span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" 
                                         :class="patient.riskScore < 30 ? 'bg-green-500' : patient.riskScore < 70 ? 'bg-yellow-500' : 'bg-red-500'"
                                         :style="`width: ${patient.riskScore || 0}%`"></div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Empty State -->
                <div x-show="!loadingPatients && patients.length === 0" 
                     class="text-center py-12">
                    <i class="fas fa-users text-4xl text-gray-400 mb-4"></i>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">No patients found</h3>
                    <p class="text-gray-600 mb-6">Try adjusting your search criteria or add a new patient</p>
                    <button @click="showCreatePatient = true" 
                            class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add First Patient
                    </button>
                </div>

                <!-- Pagination -->
                <div x-show="!loadingPatients && patients.length > 0" 
                     class="mt-8 flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        Showing <span x-text="(currentPage - 1) * patientsPerPage + 1"></span> 
                        to <span x-text="Math.min(currentPage * patientsPerPage, patientStats.total)"></span> 
                        of <span x-text="patientStats.total"></span> patients
                    </div>
                    <div class="flex items-center space-x-2">
                        <button @click="previousPage()" 
                                :disabled="currentPage === 1"
                                class="px-4 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                            Previous
                        </button>
                        <span class="px-4 py-2 bg-blue-500 text-white rounded-lg" x-text="currentPage"></span>
                        <button @click="nextPage()" 
                                :disabled="currentPage * patientsPerPage >= patientStats.total"
                                class="px-4 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                            Next
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div x-show="currentView === 'analytics'" x-transition class="fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Healthcare Analytics</h2>
                    <p class="text-gray-600">Population health insights and predictive analytics</p>
                </div>

                <!-- Analytics KPIs -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-gray-600 mb-2">Risk Predictions</h3>
                                <div x-show="!loadingAnalytics">
                                    <p class="text-3xl font-bold text-red-600 mb-2" x-text="analyticsData.riskPredictions || '0'"></p>
                                </div>
                                <div x-show="loadingAnalytics" class="w-16 h-8 skeleton skeleton-bg rounded mb-2"></div>
                                <p class="text-sm text-gray-500">High-risk patients identified</p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-gray-600 mb-2">Cost Savings</h3>
                                <div x-show="!loadingAnalytics">
                                    <p class="text-3xl font-bold text-green-600 mb-2" x-text="analyticsData.costSavings || '$0'"></p>
                                </div>
                                <div x-show="loadingAnalytics" class="w-20 h-8 skeleton skeleton-bg rounded mb-2"></div>
                                <p class="text-sm text-gray-500">Through early intervention</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-dollar-sign text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-gray-600 mb-2">Quality Score</h3>
                                <div x-show="!loadingAnalytics">
                                    <p class="text-3xl font-bold text-blue-600 mb-2" x-text="(analyticsData.qualityScore || 0) + '%'"></p>
                                </div>
                                <div x-show="loadingAnalytics" class="w-16 h-8 skeleton skeleton-bg rounded mb-2"></div>
                                <p class="text-sm text-gray-500">Care quality metrics</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-star text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6 border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-gray-600 mb-2">Efficiency</h3>
                                <div x-show="!loadingAnalytics">
                                    <p class="text-3xl font-bold text-purple-600 mb-2" x-text="(analyticsData.efficiency || 0) + '%'"></p>
                                </div>
                                <div x-show="loadingAnalytics" class="w-16 h-8 skeleton skeleton-bg rounded mb-2"></div>
                                <p class="text-sm text-gray-500">Workflow optimization</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-line text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Population Health Trends -->
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">Population Health Trends</h3>
                        <div class="chart-container">
                            <div x-show="loadingAnalytics" class="h-64 skeleton skeleton-bg rounded"></div>
                            <div x-show="!loadingAnalytics" class="h-64 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg">
                                <div class="text-center text-gray-500">
                                    <i class="fas fa-chart-area text-3xl mb-2"></i>
                                    <p>Population health trends chart</p>
                                    <p class="text-sm">Chronic conditions tracking over time</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Distribution -->
                    <div class="glass rounded-xl p-6 border border-white/20">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">Risk Distribution</h3>
                        <div class="chart-container">
                            <div x-show="loadingAnalytics" class="h-64 skeleton skeleton-bg rounded"></div>
                            <div x-show="!loadingAnalytics" class="h-64 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg">
                                <div class="text-center text-gray-500">
                                    <i class="fas fa-chart-pie text-3xl mb-2"></i>
                                    <p>Risk stratification distribution</p>
                                    <div class="text-sm mt-2 space-y-1">
                                        <div class="flex items-center justify-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span>Low Risk: <span x-text="analyticsData.lowRisk || '0'"></span>%</span>
                                        </div>
                                        <div class="flex items-center justify-center space-x-2">
                                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                            <span>Medium Risk: <span x-text="analyticsData.mediumRisk || '0'"></span>%</span>
                                        </div>
                                        <div class="flex items-center justify-center space-x-2">
                                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                            <span>High Risk: <span x-text="analyticsData.highRisk || '0'"></span>%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Notifications Panel -->
        <div x-show="showNotifications" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 transform scale-95"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-95"
             class="fixed top-16 right-4 w-96 glass rounded-xl border border-white/20 p-4 z-50 max-h-96 overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-gray-900">System Notifications</h3>
                <button @click="clearAllNotifications()" class="text-sm text-gray-500 hover:text-gray-700">
                    Clear All
                </button>
            </div>
            
            <div class="space-y-3">
                <template x-for="notification in realTimeNotifications" :key="notification.id">
                    <div class="flex items-start space-x-3 p-3 rounded-lg transition-colors"
                         :class="notification.read ? 'bg-gray-50' : 'bg-white border border-blue-200'">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center"
                             :class="notification.type === 'alert' ? 'bg-red-100 text-red-600' : 
                                    notification.type === 'vault' ? 'bg-green-100 text-green-600' : 
                                    notification.type === 'brain' ? 'bg-purple-100 text-purple-600' :
                                    'bg-blue-100 text-blue-600'">
                            <i :class="notification.icon" class="text-sm"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900" x-text="notification.title"></p>
                            <p class="text-xs text-gray-600 mt-1" x-text="notification.message"></p>
                            <div class="flex items-center justify-between mt-2">
                                <p class="text-xs text-gray-400" x-text="formatTime(notification.timestamp)"></p>
                                <button @click="markAsRead(notification.id)" 
                                        x-show="!notification.read"
                                        class="text-xs text-blue-600 hover:text-blue-800">
                                    Mark as read
                                </button>
                            </div>
                        </div>
                        <button @click="removeNotification(notification.id)" 
                                class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </div>
                </template>
            </div>

            <div x-show="realTimeNotifications.length === 0" 
                 class="text-center py-8 text-gray-500">
                <i class="fas fa-bell-slash text-3xl mb-2"></i>
                <p>No new notifications</p>
            </div>
        </div>

        <!-- Login Modal -->
        <div x-show="showLogin" x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Login to VitalCore</h2>
                <form @submit.prevent="login()">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" x-model="loginForm.email" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" x-model="loginForm.password" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex justify-between">
                        <button type="button" @click="showLogin = false"
                                class="px-4 py-2 text-gray-600 hover:text-gray-800">
                            Cancel
                        </button>
                        <button type="submit" :disabled="loggingIn"
                                class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50">
                            <span x-show="!loggingIn">Login</span>
                            <span x-show="loggingIn">Logging in...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function vitalCoreApp() {
            return {
                // Application state
                currentView: 'dashboard',
                isLoading: false,
                errorMessage: '',
                successMessage: '',
                
                // Loading states
                loadingDashboard: false,
                loadingHealth: false,
                loadingVault: false,
                loadingAuditLogs: false,
                loadingActivities: false,
                loadingMetrics: false,
                loadingPatients: false,
                loadingAnalytics: false,
                loadingAI: false,
                
                // Authentication
                currentUser: null,
                showLogin: false,
                loggingIn: false,
                loginForm: { email: '', password: '' },
                
                // Notifications
                showNotifications: false,
                realTimeNotifications: [],
                
                // Dashboard data
                dashboardStats: {},
                systemHealth: {
                    status: 'healthy',
                    overall: 100,
                    responseTime: 150,
                    compliance: 98.7,
                    aiModelsOnline: true,
                    uptime: '99.9%'
                },
                recentActivities: [],
                
                // MedVault data
                vaultData: {},
                securityMetrics: {},
                auditLogs: [],
                auditLogFilter: 'all',
                
                // MedBrain data
                brainMessages: [],
                brainInput: '',
                aiTyping: false,
                aiModelStatus: { status: 'online', version: 'Gemma 3n v3.1' },
                aiStats: {},
                
                // Patients data
                patients: [],
                patientStats: {},
                patientSearch: '',
                patientFilters: { gender: '', status: '' },
                currentPage: 1,
                patientsPerPage: 12,
                showCreatePatient: false,
                
                // Analytics data
                analyticsData: {},
                
                // Initialize application
                async init() {
                    console.log('🚀 VitalCore initializing...');
                    
                    try {
                        // Check if user is already authenticated
                        if (window.vitalcore && window.vitalcore.isAuthenticated()) {
                            this.currentUser = window.vitalcore.getCurrentUser();
                            await this.loadInitialData();
                        }
                        
                        // Setup real-time notifications
                        this.setupWebSocketListeners();
                        
                        // Initialize voice recognition
                        this.initializeVoiceRecognition();
                        
                        // Auto-refresh data every 30 seconds
                        setInterval(() => {
                            if (this.currentView === 'dashboard' && this.currentUser) {
                                this.loadDashboardData();
                            }
                        }, 30000);
                        
                    } catch (error) {
                        console.error('🔥 VitalCore initialization failed:', error);
                        this.showError('Failed to initialize application');
                    }
                },
                
                // Load all initial data
                async loadInitialData() {
                    await Promise.all([
                        this.loadDashboardData(),
                        this.loadSystemHealth(),
                        this.loadRecentActivities()
                    ]);
                },
                
                // Authentication
                async login() {
                    this.loggingIn = true;
                    try {
                        const response = await window.vitalcore.login({
                            username: this.loginForm.email,
                            password: this.loginForm.password
                        });
                        
                        this.currentUser = response.user || { 
                            name: 'Healthcare Professional',
                            role: 'Clinician',
                            initials: 'HP'
                        };
                        this.showLogin = false;
                        this.showSuccess('Welcome to VitalCore!');
                        
                        await this.loadInitialData();
                        
                    } catch (error) {
                        console.error('❌ Login failed:', error);
                        this.showError('Login failed: ' + (error.message || 'Invalid credentials'));
                    } finally {
                        this.loggingIn = false;
                    }
                },
                
                // View management
                async setView(view) {
                    if (this.currentView === view) return;
                    
                    this.currentView = view;
                    
                    // Load view-specific data
                    switch(view) {
                        case 'dashboard':
                            await this.loadDashboardData();
                            break;
                        case 'medvault':
                            await this.loadVaultData();
                            break;
                        case 'medbrain':
                            await this.loadAIData();
                            break;
                        case 'patients':
                            await this.loadPatientsData();
                            break;
                        case 'analytics':
                            await this.loadAnalyticsData();
                            break;
                    }
                },
                
                // Dashboard data loading
                async loadDashboardData() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingDashboard = true;
                    try {
                        const stats = await window.vitalcore.dashboard.getStats();
                        this.dashboardStats = {
                            secureRecords: stats.total_patients || 12847,
                            aiInteractions: stats.ai_interactions || 4563,
                            activePatients: stats.active_patients || 1284,
                            securityScore: stats.security_score || 99.9,
                            aiAccuracy: stats.ai_accuracy || 96.7
                        };
                        console.log('📊 Dashboard data loaded:', this.dashboardStats);
                    } catch (error) {
                        console.error('❌ Failed to load dashboard:', error);
                        this.showError('Failed to load dashboard data');
                    } finally {
                        this.loadingDashboard = false;
                    }
                },
                
                // System health loading
                async loadSystemHealth() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingHealth = true;
                    try {
                        const health = await window.vitalcore.dashboard.getHealth();
                        this.systemHealth = {
                            status: health.status === 'healthy' ? 'healthy' : 'issues',
                            overall: health.overall_score || 100,
                            responseTime: health.response_time_ms || 150,
                            compliance: health.compliance_score || 98.7,
                            aiModelsOnline: health.ai_models_online !== false,
                            uptime: health.uptime || '99.9%'
                        };
                        console.log('❤️ System health loaded:', this.systemHealth);
                    } catch (error) {
                        console.error('❌ Failed to load system health:', error);
                        // Set degraded state
                        this.systemHealth = {
                            status: 'issues',
                            overall: 75,
                            responseTime: 500,
                            compliance: 98.7,
                            aiModelsOnline: false,
                            uptime: '99.8%'
                        };
                    } finally {
                        this.loadingHealth = false;
                    }
                },
                
                // Recent activities loading
                async loadRecentActivities() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingActivities = true;
                    try {
                        const activities = await window.vitalcore.dashboard.getActivities(20);
                        this.recentActivities = activities.map(activity => ({
                            id: activity.id,
                            type: activity.event_type === 'ERROR' ? 'error' : 
                                  activity.event_type === 'WARNING' ? 'warning' : 'info',
                            icon: this.getActivityIcon(activity.event_type),
                            title: activity.event_description || activity.event_type,
                            description: activity.details || `${activity.resource_type} ${activity.action}`,
                            timestamp: activity.timestamp,
                            patient_id: activity.patient_id
                        }));
                        console.log('📋 Activities loaded:', this.recentActivities.length);
                    } catch (error) {
                        console.error('❌ Failed to load activities:', error);
                        this.recentActivities = [];
                    } finally {
                        this.loadingActivities = false;
                    }
                },
                
                // MedVault data loading
                async loadVaultData() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingVault = true;
                    try {
                        const [metrics, auditData] = await Promise.all([
                            window.vitalcore.medvault.security.getMetrics(),
                            window.vitalcore.medvault.getAuditLogs({ limit: 100 })
                        ]);
                        
                        this.vaultData = {
                            totalRecords: metrics.total_records || 1247893,
                            encryptedData: metrics.encrypted_data_size || '2.3TB',
                            dailyBackups: metrics.daily_backups || 365,
                            uptime: metrics.uptime || '99.9%'
                        };
                        
                        this.securityMetrics = {
                            encryptionStatus: metrics.encryption_status || 'Active',
                            auditRecords: metrics.audit_records || 5432876,
                            lastKeyRotation: metrics.last_key_rotation || 'Today',
                            breaches: metrics.security_breaches || 0
                        };
                        
                        console.log('🔐 Vault data loaded:', this.vaultData);
                        
                        await this.loadAuditLogs();
                        
                    } catch (error) {
                        console.error('❌ Failed to load vault data:', error);
                        this.showError('Failed to load security data');
                    } finally {
                        this.loadingVault = false;
                    }
                },
                
                // Audit logs loading
                async loadAuditLogs() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingAuditLogs = true;
                    try {
                        const filters = this.auditLogFilter !== 'all' ? { event_type: this.auditLogFilter } : {};
                        const logs = await window.vitalcore.medvault.getAuditLogs(filters);
                        
                        this.auditLogs = logs.logs || logs || [];
                        console.log('📜 Audit logs loaded:', this.auditLogs.length);
                        
                    } catch (error) {
                        console.error('❌ Failed to load audit logs:', error);
                        this.auditLogs = [];
                    } finally {
                        this.loadingAuditLogs = false;
                    }
                },
                
                // MedBrain AI data loading
                async loadAIData() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingAI = true;
                    try {
                        const [modelStatus, stats] = await Promise.all([
                            window.vitalcore.medbrain.getModelStatus(),
                            window.vitalcore.medbrain.models.getPerformance()
                        ]);
                        
                        this.aiModelStatus = {
                            status: modelStatus.status || 'online',
                            version: modelStatus.version || 'Gemma 3n v3.1'
                        };
                        
                        this.aiStats = {
                            conversationsToday: stats.conversations_today || 247,
                            accuracy: stats.accuracy || 96.7,
                            responseTime: stats.avg_response_time || 1.2,
                            clinicalAnalyses: stats.clinical_analyses || 1247,
                            multimodalAnalyses: stats.multimodal_analyses || 432
                        };
                        
                        console.log('🧠 AI data loaded:', this.aiStats);
                        
                    } catch (error) {
                        console.error('❌ Failed to load AI data:', error);
                        this.aiModelStatus = { status: 'offline', version: 'Unknown' };
                        this.aiStats = {};
                    } finally {
                        this.loadingAI = false;
                    }
                },
                
                // Patients data loading
                async loadPatientsData() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingPatients = true;
                    try {
                        const filters = {
                            ...this.patientFilters,
                            _count: this.patientsPerPage,
                            _skip: (this.currentPage - 1) * this.patientsPerPage
                        };
                        
                        if (this.patientSearch) {
                            filters.name = this.patientSearch;
                        }
                        
                        const [patientsResponse, statsResponse] = await Promise.all([
                            window.vitalcore.healthcare.patients.list(filters),
                            window.vitalcore.analytics.riskStratification.getPopulationSummary()
                        ]);
                        
                        this.patients = patientsResponse.entry ? 
                            patientsResponse.entry.map(entry => entry.resource) : 
                            patientsResponse.patients || [];
                            
                        this.patientStats = {
                            total: patientsResponse.total || this.patients.length,
                            activeToday: statsResponse.active_today || 142,
                            highRisk: statsResponse.high_risk_count || 23,
                            newThisMonth: statsResponse.new_this_month || 89
                        };
                        
                        console.log('👥 Patients loaded:', this.patients.length);
                        
                    } catch (error) {
                        console.error('❌ Failed to load patients:', error);
                        this.patients = [];
                        this.patientStats = { total: 0, activeToday: 0, highRisk: 0, newThisMonth: 0 };
                        this.showError('Failed to load patient data');
                    } finally {
                        this.loadingPatients = false;
                    }
                },
                
                // Analytics data loading
                async loadAnalyticsData() {
                    if (!window.vitalcore || !window.vitalcore.isAuthenticated()) return;
                    
                    this.loadingAnalytics = true;
                    try {
                        const [riskData, qualityData, costData] = await Promise.all([
                            window.vitalcore.analytics.riskDistribution({ timeframe: '30d' }),
                            window.vitalcore.analytics.qualityMeasures({ period: 'current_quarter' }),
                            window.vitalcore.analytics.costAnalysis({ period: 'ytd' })
                        ]);
                        
                        this.analyticsData = {
                            riskPredictions: riskData.high_risk_patients || 247,
                            costSavings: costData.total_savings || '$2.4M',
                            qualityScore: qualityData.overall_score || 94.2,
                            efficiency: qualityData.workflow_efficiency || 87.3,
                            lowRisk: riskData.distribution?.low || 65,
                            mediumRisk: riskData.distribution?.medium || 25,
                            highRisk: riskData.distribution?.high || 10
                        };
                        
                        console.log('📊 Analytics loaded:', this.analyticsData);
                        
                    } catch (error) {
                        console.error('❌ Failed to load analytics:', error);
                        this.analyticsData = {
                            riskPredictions: 0,
                            costSavings: '$0',
                            qualityScore: 0,
                            efficiency: 0,
                            lowRisk: 0,
                            mediumRisk: 0,
                            highRisk: 0
                        };
                    } finally {
                        this.loadingAnalytics = false;
                    }
                },
                
                // MedBrain chat functionality
                async sendBrainMessage() {
                    if (!this.brainInput.trim() || this.aiTyping) return;
                    
                    const userMessage = this.brainInput;
                    this.brainInput = '';
                    
                    // Add user message
                    this.brainMessages.push({
                        id: Date.now(),
                        sender: 'user',
                        content: userMessage,
                        timestamp: new Date().toISOString()
                    });
                    
                    // Scroll to bottom
                    this.$nextTick(() => {
                        const container = document.getElementById('chat-container');
                        container.scrollTop = container.scrollHeight;
                    });
                    
                    this.aiTyping = true;
                    
                    try {
                        const response = await window.vitalcore.medbrain.clinicalAnalysis({
                            query: userMessage,
                            context: 'clinical_consultation'
                        });
                        
                        this.brainMessages.push({
                            id: Date.now() + 1,
                            sender: 'ai',
                            content: response.analysis || response.message || 'I understand your question about clinical care. Based on current medical guidelines and evidence-based medicine, I recommend consulting the latest clinical protocols for this specific condition.',
                            timestamp: new Date().toISOString(),
                            confidence: response.confidence || 95
                        });
                        
                    } catch (error) {
                        console.error('❌ AI message failed:', error);
                        this.brainMessages.push({
                            id: Date.now() + 1,
                            sender: 'ai',
                            content: 'I apologize, but I\'m experiencing technical difficulties. Please ensure the AI models are online and try again.',
                            timestamp: new Date().toISOString(),
                            confidence: 0
                        });
                    } finally {
                        this.aiTyping = false;
                        
                        // Scroll to bottom
                        this.$nextTick(() => {
                            const container = document.getElementById('chat-container');
                            container.scrollTop = container.scrollHeight;
                        });
                    }
                },
                
                sendQuickMessage(message) {
                    this.brainInput = message;
                    this.sendBrainMessage();
                },
                
                clearChat() {
                    this.brainMessages = [{
                        id: 1,
                        sender: 'ai',
                        content: 'Hello! I\'m MedBrain, your clinical AI assistant powered by Gemma 3n. I can help with diagnosis, treatment planning, drug interactions, and clinical guidelines. What would you like to discuss?',
                        timestamp: new Date().toISOString()
                    }];
                },
                
                // Patient management
                async searchPatients() {
                    await this.loadPatientsData();
                },
                
                resetFilters() {
                    this.patientSearch = '';
                    this.patientFilters = { gender: '', status: '' };
                    this.currentPage = 1;
                    this.searchPatients();
                },
                
                viewPatient(patient) {
                    console.log('👤 Viewing patient:', patient);
                    // TODO: Open patient detail modal or navigate to patient page
                    this.showSuccess(`Viewing patient: ${this.getPatientName(patient)}`);
                },
                
                previousPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.loadPatientsData();
                    }
                },
                
                nextPage() {
                    if (this.currentPage * this.patientsPerPage < this.patientStats.total) {
                        this.currentPage++;
                        this.loadPatientsData();
                    }
                },
                
                // Notifications
                setupWebSocketListeners() {
                    if (window.vitalcore) {
                        window.vitalcore.subscribe('patient-alert', (data) => {
                            this.addNotification({
                                type: 'alert',
                                icon: 'fas fa-exclamation-triangle',
                                title: 'Patient Alert',
                                message: data.message || 'High-risk patient requires attention',
                                timestamp: new Date().toISOString()
                            });
                        });
                        
                        window.vitalcore.subscribe('security-violation', (data) => {
                            this.addNotification({
                                type: 'alert',
                                icon: 'fas fa-shield-alt',
                                title: 'Security Alert',
                                message: data.message || 'Security incident detected',
                                timestamp: new Date().toISOString()
                            });
                        });
                        
                        window.vitalcore.subscribe('ai-analysis-complete', (data) => {
                            this.addNotification({
                                type: 'brain',
                                icon: 'fas fa-brain',
                                title: 'AI Analysis Complete',
                                message: data.message || 'Clinical analysis has been completed',
                                timestamp: new Date().toISOString()
                            });
                        });
                    }
                    
                    // Listen for global events
                    window.addEventListener('vitalcore-notification', (event) => {
                        this.handleGlobalNotification(event.detail);
                    });
                },
                
                addNotification(notification) {
                    this.realTimeNotifications.unshift({
                        id: Date.now(),
                        read: false,
                        ...notification
                    });
                    
                    // Keep only latest 50 notifications
                    if (this.realTimeNotifications.length > 50) {
                        this.realTimeNotifications = this.realTimeNotifications.slice(0, 50);
                    }
                },
                
                markAsRead(notificationId) {
                    const notification = this.realTimeNotifications.find(n => n.id === notificationId);
                    if (notification) {
                        notification.read = true;
                    }
                },
                
                removeNotification(notificationId) {
                    this.realTimeNotifications = this.realTimeNotifications.filter(n => n.id !== notificationId);
                },
                
                clearAllNotifications() {
                    this.realTimeNotifications = [];
                    this.showNotifications = false;
                },
                
                handleGlobalNotification(data) {
                    this.addNotification({
                        type: data.type || 'info',
                        icon: data.icon || 'fas fa-info-circle',
                        title: data.title || 'System Notification',
                        message: data.message || 'System event occurred',
                        timestamp: data.timestamp || new Date().toISOString()
                    });
                },
                
                // Utility methods
                showError(message) {
                    this.errorMessage = message;
                    setTimeout(() => { this.errorMessage = ''; }, 5000);
                },
                
                showSuccess(message) {
                    this.successMessage = message;
                    setTimeout(() => { this.successMessage = ''; }, 3000);
                },
                
                formatTime(timestamp) {
                    if (!timestamp) return '';
                    return new Date(timestamp).toLocaleString();
                },
                
                formatMessage(content) {
                    // Basic HTML formatting for AI responses
                    return content
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/\n/g, '<br>');
                },
                
                getActivityIcon(eventType) {
                    const iconMap = {
                        'PHI_ACCESS': 'fas fa-eye',
                        'LOGIN': 'fas fa-sign-in-alt',
                        'LOGOUT': 'fas fa-sign-out-alt',
                        'PATIENT_CREATE': 'fas fa-user-plus',
                        'PATIENT_UPDATE': 'fas fa-user-edit',
                        'IMMUNIZATION_CREATE': 'fas fa-syringe',
                        'SECURITY_VIOLATION': 'fas fa-exclamation-triangle',
                        'AI_ANALYSIS': 'fas fa-brain',
                        'SYSTEM_ERROR': 'fas fa-exclamation-circle'
                    };
                    return iconMap[eventType] || 'fas fa-info-circle';
                },
                
                getPatientName(patient) {
                    if (!patient.name || patient.name.length === 0) return 'Unknown Patient';
                    const name = patient.name[0];
                    return `${name.given ? name.given.join(' ') : ''} ${name.family || ''}`.trim() || 'Unknown Patient';
                },
                
                getPatientInitials(patient) {
                    const name = this.getPatientName(patient);
                    return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() || 'UK';
                },
                
                getPatientMRN(patient) {
                    if (!patient.identifier) return 'No MRN';
                    const mrn = patient.identifier.find(id => id.type && id.type.text === 'MRN');
                    return mrn ? mrn.value : patient.identifier[0]?.value || 'No MRN';
                },
                
                calculateAge(birthDate) {
                    if (!birthDate) return 'Unknown';
                    const today = new Date();
                    const birth = new Date(birthDate);
                    const age = today.getFullYear() - birth.getFullYear();
                    return age;
                },
                
                getRiskLevel(score) {
                    if (score < 30) return 'Low Risk';
                    if (score < 70) return 'Medium Risk';
                    return 'High Risk';
                },
                
                // Enhanced MedBrain with Voice Recognition and Specialist Selection
                selectedSpecialist: 'general',
                specialists: [
                    {
                        id: 'general',
                        name: 'General Practice',
                        description: 'Primary care and general medical conditions',
                        icon: 'fas fa-user-md',
                        gradient: 'general-gradient'
                    },
                    {
                        id: 'cardiology',
                        name: 'Cardiology',
                        description: 'Heart and cardiovascular system',
                        icon: 'fas fa-heartbeat',
                        gradient: 'cardiology-gradient'
                    },
                    {
                        id: 'psychology',
                        name: 'Psychology',
                        description: 'Mental health and behavioral therapy',
                        icon: 'fas fa-brain',
                        gradient: 'psychology-gradient'
                    },
                    {
                        id: 'pediatrics',
                        name: 'Pediatrics',
                        description: 'Child and adolescent healthcare',
                        icon: 'fas fa-child',
                        gradient: 'pediatric-gradient'
                    },
                    {
                        id: 'neurology',
                        name: 'Neurology',
                        description: 'Brain and nervous system disorders',
                        icon: 'fas fa-brain',
                        gradient: 'neurology-gradient'
                    },
                    {
                        id: 'oncology',
                        name: 'Oncology',
                        description: 'Cancer diagnosis and treatment',
                        icon: 'fas fa-ribbon',
                        gradient: 'oncology-gradient'
                    },
                    {
                        id: 'radiology',
                        name: 'Radiology',
                        description: 'Medical imaging and diagnostics',
                        icon: 'fas fa-x-ray',
                        gradient: 'radiology-gradient'
                    },
                    {
                        id: 'emergency',
                        name: 'Emergency Medicine',
                        description: 'Acute care and emergency treatment',
                        icon: 'fas fa-ambulance',
                        gradient: 'emergency-gradient'
                    }
                ],
                
                // Voice Recognition
                voiceSupported: false,
                isRecording: false,
                isListening: false,
                recognition: null,
                synthesis: null,
                
                getSpecialistGradient(specialistId) {
                    const specialist = this.specialists.find(s => s.id === specialistId);
                    return specialist ? specialist.gradient : 'general-gradient';
                },
                
                getSpecialistIcon(specialistId) {
                    const specialist = this.specialists.find(s => s.id === specialistId);
                    return specialist ? specialist.icon : 'fas fa-user-md';
                },
                
                initializeVoiceRecognition() {
                    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                        this.recognition = new SpeechRecognition();
                        this.recognition.continuous = false;
                        this.recognition.interimResults = false;
                        this.recognition.lang = 'en-US';
                        
                        this.recognition.onstart = () => {
                            this.isRecording = true;
                            this.isListening = true;
                            console.log('🎤 Voice recognition started');
                        };
                        
                        this.recognition.onresult = (event) => {
                            const result = event.results[0][0].transcript;
                            const confidence = Math.round(event.results[0][0].confidence * 100);
                            
                            this.brainInput = result;
                            this.isRecording = false;
                            
                            console.log('🗣️ Voice input:', result, 'Confidence:', confidence + '%');
                            
                            // Auto-send if confidence is high
                            if (confidence > 70) {
                                setTimeout(() => {
                                    this.sendBrainMessage('voice', confidence);
                                }, 500);
                            }
                        };
                        
                        this.recognition.onerror = (event) => {
                            console.error('🔥 Voice recognition error:', event.error);
                            this.isRecording = false;
                            this.isListening = false;
                            
                            let errorMsg = 'Voice recognition failed';
                            if (event.error === 'no-speech') {
                                errorMsg = 'No speech detected. Please try again.';
                            } else if (event.error === 'not-allowed') {
                                errorMsg = 'Microphone access denied. Please allow microphone permissions.';
                            }
                            
                            this.showError(errorMsg);
                        };
                        
                        this.recognition.onend = () => {
                            this.isRecording = false;
                            this.isListening = false;
                            console.log('🛑 Voice recognition ended');
                        };
                        
                        this.voiceSupported = true;
                    }
                    
                    // Initialize speech synthesis
                    if ('speechSynthesis' in window) {
                        this.synthesis = window.speechSynthesis;
                    }
                },
                
                toggleVoiceInput() {
                    if (!this.voiceSupported) {
                        this.showError('Voice recognition not supported in this browser');
                        return;
                    }
                    
                    if (this.isRecording) {
                        this.recognition.stop();
                    } else {
                        this.recognition.start();
                    }
                },
                
                speakResponse(text) {
                    if (!this.synthesis || !text) return;
                    
                    // Cancel any ongoing speech
                    this.synthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    utterance.volume = 0.8;
                    
                    // Try to use a medical/professional voice
                    const voices = this.synthesis.getVoices();
                    const preferredVoice = voices.find(voice => 
                        voice.name.includes('Female') || voice.name.includes('Alex') || voice.name.includes('Samantha')
                    );
                    
                    if (preferredVoice) {
                        utterance.voice = preferredVoice;
                    }
                    
                    this.synthesis.speak(utterance);
                },
                
                async sendBrainMessage(inputType = 'text', confidence = null) {
                    if (!this.brainInput.trim()) return;
                    
                    const userMessage = {
                        id: Date.now(),
                        sender: 'user',
                        content: this.brainInput,
                        timestamp: new Date().toISOString(),
                        inputType,
                        confidence
                    };
                    
                    this.brainMessages.push(userMessage);
                    
                    const userQuery = this.brainInput;
                    this.brainInput = '';
                    this.aiTyping = true;
                    
                    try {
                        // Get specialist context
                        const specialist = this.specialists.find(s => s.id === this.selectedSpecialist);
                        const specialistContext = specialist ? 
                            `As a ${specialist.name} specialist focusing on ${specialist.description.toLowerCase()}, ` : '';
                        
                        // Enhanced prompt with specialist context
                        const enhancedQuery = `${specialistContext}${userQuery}`;
                        
                        // Simulate AI response (replace with real API call)
                        const response = await this.getAIResponse(enhancedQuery);
                        
                        const aiMessage = {
                            id: Date.now() + 1,
                            sender: 'ai',
                            content: response.content,
                            timestamp: new Date().toISOString(),
                            confidence: response.confidence,
                            specialist: this.selectedSpecialist
                        };
                        
                        this.brainMessages.push(aiMessage);
                        
                        // Speak the response if voice was used for input
                        if (inputType === 'voice' && response.content) {
                            setTimeout(() => {
                                this.speakResponse(response.content);
                            }, 500);
                        }
                        
                    } catch (error) {
                        console.error('🔥 MedBrain error:', error);
                        this.showError('Failed to get AI response');
                    } finally {
                        this.aiTyping = false;
                        
                        // Auto-scroll to bottom
                        setTimeout(() => {
                            const container = document.getElementById('chat-container');
                            if (container) {
                                container.scrollTop = container.scrollHeight;
                            }
                        }, 100);
                    }
                },
                
                async getAIResponse(query) {
                    // Get specialist-specific response
                    const specialist = this.specialists.find(s => s.id === this.selectedSpecialist);
                    const specialistResponses = this.getSpecialistResponses(this.selectedSpecialist);
                    
                    // Find matching response or use default
                    const queryLower = query.toLowerCase();
                    let response = specialistResponses.find(r => 
                        r.keywords.some(keyword => queryLower.includes(keyword.toLowerCase()))
                    );
                    
                    if (!response) {
                        response = specialistResponses.find(r => r.isDefault);
                    }
                    
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                    
                    return {
                        content: response ? response.response : this.getGenericResponse(query),
                        confidence: Math.round(85 + Math.random() * 10) // 85-95%
                    };
                },
                
                getSpecialistResponses(specialistId) {
                    const responses = {
                        cardiology: [
                            {
                                keywords: ['chest pain', 'heart attack', 'cardiac', 'angina'],
                                response: "For chest pain evaluation, we need to consider cardiac vs non-cardiac causes. Key assessments include ECG, troponins, and risk stratification using HEART score. Immediate concerns are ACS, PE, and aortic dissection.",
                                confidence: 95
                            },
                            {
                                keywords: ['blood pressure', 'hypertension', 'BP'],
                                response: "Hypertension management follows ACC/AHA guidelines: <140/90 for most patients, <130/80 for high-risk. First-line: ACE inhibitors, ARBs, CCBs, or thiazide diuretics. Regular monitoring and lifestyle modifications are essential.",
                                confidence: 92
                            },
                            {
                                isDefault: true,
                                response: "As a cardiologist, I can help with heart conditions, chest pain, hypertension, arrhythmias, and cardiovascular risk assessment. What specific cardiac concern would you like to discuss?",
                                confidence: 88
                            }
                        ],
                        psychology: [
                            {
                                keywords: ['depression', 'anxiety', 'mental health', 'therapy'],
                                response: "For depression/anxiety screening, use PHQ-9 and GAD-7 tools. Treatment includes CBT, medications (SSRIs as first-line), lifestyle modifications, and regular follow-up. Consider severity and patient preferences.",
                                confidence: 94
                            },
                            {
                                keywords: ['stress', 'coping', 'emotional'],
                                response: "Stress management involves identifying triggers, developing coping strategies, mindfulness techniques, and building support systems. Consider both psychological and physiological impacts.",
                                confidence: 90
                            },
                            {
                                isDefault: true,
                                response: "I can assist with mental health assessments, therapeutic approaches, behavioral interventions, and psychological well-being strategies. What aspect of mental health would you like to explore?",
                                confidence: 87
                            }
                        ],
                        pediatrics: [
                            {
                                keywords: ['vaccination', 'immunization', 'vaccine schedule'],
                                response: "Pediatric immunization follows CDC/ACIP guidelines. Standard schedule includes: HepB (birth), DTaP, PCV13, Hib, IPV, MMR, Varicella, and annual influenza. Maintain accurate records and educate parents.",
                                confidence: 96
                            },
                            {
                                keywords: ['growth', 'development', 'milestones'],
                                response: "Growth assessment uses CDC/WHO charts. Key milestones: sitting (6mo), walking (12mo), first words (12mo), sentences (24mo). Regular screening for developmental delays is crucial.",
                                confidence: 93
                            },
                            {
                                isDefault: true,
                                response: "I specialize in child and adolescent healthcare including growth monitoring, developmental assessments, immunizations, and pediatric conditions. How can I help with your pediatric question?",
                                confidence: 89
                            }
                        ],
                        general: [
                            {
                                keywords: ['diabetes', 'blood sugar', 'A1C'],
                                response: "Type 2 diabetes management: target A1C <7% for most adults. First-line metformin, lifestyle modifications, regular monitoring. Consider cardiovascular benefits of SGLT2i or GLP-1 agonists in appropriate patients.",
                                confidence: 91
                            },
                            {
                                isDefault: true,
                                response: "I can help with general medical questions, preventive care, chronic disease management, medication reviews, and clinical decision support. What would you like to discuss?",
                                confidence: 85
                            }
                        ]
                    };
                    
                    return responses[specialistId] || responses.general;
                },
                
                getGenericResponse(query) {
                    const genericResponses = [
                        "I understand your question. For the most accurate medical advice, please consult with the appropriate specialist. I can provide general information and help guide your clinical thinking.",
                        "That's an interesting clinical question. Based on current evidence and guidelines, I'd recommend a systematic approach. Would you like me to walk through the diagnostic or treatment considerations?",
                        "For this medical query, we should consider evidence-based approaches and current clinical guidelines. What specific aspect would you like me to focus on?"
                    ];
                    
                    return genericResponses[Math.floor(Math.random() * genericResponses.length)];
                },
                
                sendQuickMessage(message) {
                    this.brainInput = message;
                    this.sendBrainMessage();
                },
                
                clearChat() {
                    this.brainMessages = [];
                    console.log('🧹 Chat cleared');
                }
            };
        }
    </script>
</body>
</html>